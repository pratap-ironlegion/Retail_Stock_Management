<!DOCTYPE html>
<html>
<head>
  <title>Add Product</title>
  <link rel="stylesheet" href="style.css">
  <style>
    #nameList {
      border: 1px solid #ccc;
      background: white;
      position: absolute;
      z-index: 100;
      max-height: 150px;
      overflow-y: auto;
      width: 280px;
      left: 0; right: 0;
      margin: auto;
      display: none;
    }

    #nameList div {
      padding: 10px;
      cursor: pointer;
    }

    #nameList div:hover {
      background-color: #f1f1f1;
    }

    .position-relative {
      position: relative;
    }
  </style>
</head>
<body>
  <header>
    New Inventory
    <button id="themeToggle" class="theme-toggle">üåô Dark Mode</button>
  </header>

  <div class="container">
    <h2>Add New Product</h2>
    <form id="addProductForm">
      <label>Product Name:</label>
      <div class="position-relative">
        <input type="text" id="name" autocomplete="off" required />
        <div id="nameList"></div>
      </div>

      <label>Quantity:</label>
      <input type="number" id="quantity" required>

      <label>Critical Limit:</label>
      <input type="number" id="criticalLimit" required>

      <button type="submit">Add Product</button>
    </form>

    <p id="msg" style="text-align:center; margin-top: 10px;"></p>
  </div>

  <script>
    // üåô Theme Toggle
    const toggle = document.getElementById('themeToggle');
    const body = document.body;

    if (localStorage.getItem('theme') === 'dark') {
      body.classList.add('dark-mode');
      toggle.innerText = '‚òÄÔ∏è Light Mode';
    }

    toggle.addEventListener('click', () => {
      body.classList.toggle('dark-mode');
      const isDark = body.classList.contains('dark-mode');
      toggle.innerText = isDark ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    });

    // üß† Autocomplete + Duplicate Check
    let productNames = [];

    fetch('/api/stock/names')
      .then(res => res.json())
      .then(data => {
        if (data.success) productNames = data.names;
      });

    const nameInput = document.getElementById('name');
    const nameList = document.getElementById('nameList');

    nameInput.addEventListener("input", () => {
      const input = nameInput.value.toLowerCase();
      nameList.innerHTML = '';

      if (!input) {
        nameList.style.display = "none";
        return;
      }

      const filtered = productNames.filter(name =>
        name.toLowerCase().includes(input)
      );

      filtered.forEach(name => {
        const div = document.createElement("div");
        div.textContent = name;
        div.onclick = () => {
          nameInput.value = name;
          nameList.style.display = "none";
        };
        nameList.appendChild(div);
      });

      nameList.style.display = filtered.length ? "block" : "none";
    });

    // ‚úÖ Add Product Form Handler
    document.getElementById('addProductForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const name = nameInput.value.trim();
      const quantity = document.getElementById('quantity').value;
      const criticalLimit = document.getElementById('criticalLimit').value;

      if (productNames.includes(name)) {
        alert("‚ùå Product already exists.");
        return;
      }

      const res = await fetch('/api/stock/add', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, quantity, criticalLimit })
      });

      const data = await res.json();
      document.getElementById('msg').innerText = data.message;
      alert(data.message);

      if (data.success) {
        productNames.push(name);
        document.getElementById("addProductForm").reset();
        nameList.style.display = "none";
      }
    });
  </script>

  <footer>
    &copy; 2025 Nova Squaqron Team | Built for Hackathon
  </footer>
</html>
