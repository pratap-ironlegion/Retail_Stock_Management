<!DOCTYPE html>
<html>
<head>
  <title>Delete Product</title>
  <link rel="stylesheet" href="style.css">
  <style>
    #nameList {
      border: 1px solid #ccc;
      background: white;
      position: absolute;
      z-index: 100;
      max-height: 150px;
      overflow-y: auto;
      width: 280px;
      margin-left: auto;
      margin-right: auto;
      left: 0; right: 0;
      display: none;
    }

    #nameList div {
      padding: 10px;
      cursor: pointer;
    }

    #nameList div:hover {
      background-color: #f1f1f1;
    }

    .position-relative {
      position: relative;
    }
  </style>
</head>
<body>
  <header>
    Delete Product
    <button id="themeToggle" class="theme-toggle">üåô Dark Mode</button>
  </header>

  <div class="container">
    <h2>üóëÔ∏è Delete Product</h2>
    <form id="deleteForm">
      <label>Product Name:</label>
      <div class="position-relative">
        <input type="text" id="name" autocomplete="off" required />
        <div id="nameList"></div>
      </div>

      <button type="submit" style="background-color: #e74c3c;">Delete Product</button>
    </form>

    <p id="msg" style="text-align:center; margin-top: 10px;"></p>
  </div>

  <script>
    // üåó Theme toggle
    const toggle = document.getElementById('themeToggle');
    const body = document.body;

    if (localStorage.getItem('theme') === 'dark') {
      body.classList.add('dark-mode');
      toggle.innerText = '‚òÄÔ∏è Light Mode';
    }

    toggle.addEventListener('click', () => {
      body.classList.toggle('dark-mode');
      const isDark = body.classList.contains('dark-mode');
      toggle.innerText = isDark ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    });

    // üß† Autocomplete logic
    let productNames = [];

    fetch('/api/stock/names')
      .then(res => res.json())
      .then(data => {
        if (data.success) productNames = data.names;
      });

    const nameInput = document.getElementById('name');
    const nameList = document.getElementById('nameList');

    nameInput.addEventListener("input", () => {
      const input = nameInput.value.toLowerCase();
      nameList.innerHTML = '';

      if (!input) {
        nameList.style.display = "none";
        return;
      }

      const filtered = productNames.filter(name =>
        name.toLowerCase().includes(input)
      );

      filtered.forEach(name => {
        const div = document.createElement("div");
        div.textContent = name;
        div.onclick = () => {
          nameInput.value = name;
          nameList.style.display = "none";
        };
        nameList.appendChild(div);
      });

      nameList.style.display = filtered.length ? "block" : "none";
    });

    // üóëÔ∏è Delete form handler
    document.getElementById("deleteForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const name = nameInput.value.trim();

      if (!productNames.includes(name)) {
        alert("‚ö†Ô∏è Product not found.");
        return;
      }

      const confirmDelete = confirm(`Are you sure you want to delete "${name}"?`);
      if (!confirmDelete) return;

      const res = await fetch('/api/stock/delete', {
        method: 'DELETE',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name })
      });

      const data = await res.json();
      document.getElementById("msg").textContent = data.message;

      if (data.success) {
        productNames = productNames.filter(n => n !== name);
        document.getElementById("deleteForm").reset();
      }
    });
  </script>

  <footer>
    &copy; 2025 Nova Squaqron Team | Built for Hackathon
  </footer>
</body>
</html>
